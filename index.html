
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر التصاميم</title>
‎    <!-- تضمين المكتبات -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        :root {
            --primary-color: #0083b0;
            --secondary-color: #00b4db;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 1rem;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 100px 0;
            margin-bottom: 30px;
        }

        .product-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px 10px 0 0;
        }

        .product-info {
            padding: 20px;
        }

        .price {
            color: var(--primary-color);
            font-size: 1.25rem;
            font-weight: bold;
        }

        .cart-badge {
            position: absolute;
            top: -8px;

right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-paint-brush me-2"></i>
                متجر التصاميم
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#home">الرئيسية</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#products">المنتجات</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">اتصل بنا</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-light position-relative me-3" id="cartBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge" id="cartBadge">0</span>
                    </button>
                    <button class="btn btn-outline-light me-2" id="loginBtn">تسجيل دخول</button>
                    <button class="btn btn-outline-light" id="logoutBtn" style="display: none;">تسجيل خروج</button>
                </div>
            </div>

</div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-center" id="home">
        <div class="container">
            <h1 class="display-4 mb-4">مرحباً بك في متجر التصاميم</h1>
            <p class="lead mb-4">اكتشف مجموعة متنوعة من التصاميم الإبداعية</p>
            <button class="btn btn-light btn-lg" onclick="scrollToProducts()">تصفح المنتجات</button>
        </div>
    </section>

    <!-- المنتجات -->
    <section class="py-5" id="products">
        <div class="container">
            <h2 class="text-center mb-4">منتجاتنا المميزة</h2>
            <div class="row" id="productsContainer">
                <!-- سيتم ملؤه بواسطة JavaScript -->
            </div>
        </div>
    </section>

    <!-- نموذج السلة -->
    <div class="modal fade" id="cartModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">سلة المشتريات</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="cartItems">
                    <!-- سيتم ملؤه بواسطة JavaScript -->
                </div>
                <div class="modal-footer">
                    <div class="w-100">
                        <div class="d-flex justify-content-between mb-3">
                            <h5>المجموع:</h5>
                            <h5 id="cartTotal">0 ريال</h5>
                        </div>
                        <button class="btn btn-primary w-100" onclick="checkout()">إتمام الطلب</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- تضمين Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // تهيئة Supabase
        const supabase = createClient(

'https://jocgtfekndsdcfftmlhs.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvY2d0ZmVrbmRzZGNmZnRtbGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYzMzMyNzUsImV4cCI6MjA1MTkwOTI3NX0.tTW9sM6cVknt7N01AWTEJwyzxlxZdIksc0pxyLptLSk'
        );

        // تهيئة EmailJS
        emailjs.init("service_l82w2oc");

        // بيانات المنتجات
        const products = [
            {
                id: 1,
                name: "تصميم شعار احترافي",
                price: 299,
                image: "https://via.placeholder.com/300x200?text=Logo+Design",
                description: "تصميم شعار مميز لعلامتك التجارية"
            },
            {
                id: 2,
                name: "تصميم هوية بصرية",
                price: 599,
                image: "https://via.placeholder.com/300x200?text=Brand+Identity",
                description: "هوية بصرية متكاملة لمشروعك"
            },
            {
                id: 3,
                name: "تصميم سوشيال ميديا",
                price: 199,
                image: "https://via.placeholder.com/300x200?text=Social+Media",
                description: "تصاميم جذابة لمنصات التواصل الاجتماعي"
            }
        ];

        // عرض المنتجات
        function displayProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = products.map(product => `
                <div class="col-md-4 mb-4">
                    <div class="product-card">
                        <img src="${product.image}" class="product-image" alt="${product.name}">
                        <div class="product-info">
                            <h5>${product.name}</h5>
                            <p class="text-muted">${product.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="price">${product.price} ريال</span>

<button class="btn btn-primary" onclick="addToCart(${product.id})">
                                    إضافة للسلة
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // إضافة للسلة
        function addToCart(productId) {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                alert('الرجاء تسجيل الدخول أولاً');
                window.location.href = 'login.html';
                return;
            }

            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const product = products.find(p => p.id === productId);

            if (product) {
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartBadge();
                alert('تمت الإضافة للسلة');
            }
        }

        // تحديث شارة السلة
        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const badge = document.getElementById('cartBadge');
            const total = cart.reduce((sum, item) => sum + item.quantity, 0);
            badge.textContent = total;
        }

        // عرض السلة
        function showCart() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');

            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-center">السلة فارغة</p>';

cartTotal.textContent = '0 ريال';
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6 class="mb-0">${item.name}</h6>
                            <small class="text-muted">${item.price} ريال × ${item.quantity}</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <button class="btn btn-sm btn-outline-danger" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                            <span class="mx-2">${item.quantity}</span>
                            <button class="btn btn-sm btn-outline-success" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                        </div>
                    </div>
                `).join('');

                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotal.textContent = `${total} ريال`;
            }

            new bootstrap.Modal(document.getElementById('cartModal')).show();
        }

        // تحديث الكمية
        function updateQuantity(id, newQuantity) {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');

            if (newQuantity < 1) {
                cart = cart.filter(item => item.id !== id);
            } else {
                const item = cart.find(item => item.id === id);
                if (item) item.quantity = newQuantity;
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            showCart();
        }

        // إتمام الطلب
        async function checkout() {
            const user = JSON.parse(localStorage.getItem('user'));
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');

            if (!user || cart.length === 0) {

alert('الرجاء تسجيل الدخول وإضافة منتجات للسلة');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('orders')
                    .insert([{
                        user_id: user.id,
                        items: cart,
                        total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                        status: 'pending'
                    }]);

                if (error) throw error;

                await emailjs.send("service_l82w2oc", "template_43nya5a", {
                    to_name: user.email,
                    message: "تم استلام طلبك بنجاح"
                });

                localStorage.removeItem('cart');
                updateCartBadge();
                bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
                alert('تم إرسال طلبك بنجاح!');

            } catch (error) {
                console.error('Error:', error);
                alert('حدث خطأ أثناء إتمام الطلب');
            }
        }

        // التنقل إلى قسم المنتجات
        function scrollToProducts() {
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }

// تهيئة الصفحة
document.addEventListener('DOMContentLoaded', () => {
    // عرض المنتجات
    displayProducts();
    
    // تحديث السلة
    updateCartBadge();

    // إضافة مستمع لزر السلة
    document.getElementById('cartBtn').addEventListener('click', showCart);

    // إضافة مستمع لزر تسجيل الدخول
    document.getElementById('loginBtn').addEventListener('click', () => {
        window.location.href = 'login.html';
    });

    // إضافة مستمع لزر تسجيل الخروج
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        try {
            await supabase.auth.signOut();
            localStorage.removeItem('user');
            localStorage.removeItem('cart');
            updateCartBadge();
            window.location.href = 'login.html';
        } catch (error) {
            console.error('Error signing out:', error);
            alert('حدث خطأ أثناء تسجيل الخروج');
        }
    });

    // التحقق من حالة تسجيل الدخول
    checkAuthStatus();
});

// التحقق من حالة تسجيل الدخول
async function checkAuthStatus() {
    const { data: { session }, error } = await supabase.auth.getSession();
    
    if (session) {
        // المستخدم مسجل دخول
        localStorage.setItem('user', JSON.stringify(session.user));
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
    } else {
        // المستخدم غير مسجل دخول
        document.getElementById('loginBtn').style.display = 'inline-block';
        document.getElementById('logoutBtn').style.display = 'none';
    }
}
</script>
</body>
</html>
