<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر التصاميم</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #0083b0;
            --secondary-color: #00b4db;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 100px 0;
        }

        .design-card {
            transition: transform 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .design-card:hover {
            transform: translateY(-5px);
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#">متجر التصاميم</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

<div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="#home">الرئيسية</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#designs">التصاميم</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#contact">تواصل معنا</a>
                </li>
            </ul>
            <div class="d-flex align-items-center">
                <span class="text-white me-3" id="userName"></span>
                <button class="btn btn-outline-light me-2" id="cartBtn">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </button>
                <button class="btn btn-outline-light" id="loginBtn">تسجيل دخول</button>
                <button class="btn btn-outline-light" id="logoutBtn" style="display: none;">تسجيل خروج</button>
            </div>
        </div>
    </div>
</nav>

<section class="hero-section" id="home">
    <div class="container text-center">
        <h1>أفضل التصاميم الإبداعية</h1>
        <p class="lead">نقدم تصاميم احترافية تناسب احتياجاتك</p>
    </div>
</section>

<section class="py-5" id="designs">
    <div class="container">
        <h2 class="text-center mb-4">تصاميمنا المميزة</h2>
        <div class="row" id="designsContainer"></div>
    </div>
</section>

‎<!-- نافذة السلة -->
<div class="modal fade" id="cartModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">سلة المشتريات</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="cartItems"></div>
                <div class="text-end mt-3">

<h5>المجموع: <span id="cartTotal">0</span> ريال</h5>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="checkout()">إتمام الطلب</button>
            </div>
        </div>
    </div>
</div>

<script>
// تهيئة Supabase
const supabaseUrl = 'https://jocgtfekndsdcfftmlhs.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvY2d0ZmVrbmRzZGNmZnRtbGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYzMzMyNzUsImV4cCI6MjA1MTkwOTI3NX0.tTW9sM6cVknt7N01AWTEJwyzxlxZdIksc0pxyLptLSk';
const supabase = createClient(supabaseUrl, supabaseKey);

// تهيئة EmailJS
emailjs.init("service_l82w2oc");

// بيانات التصاميم
const designs = [
    {
        id: 1,
        title: "شعار احترافي",
        price: 299,
        image: "https://via.placeholder.com/300x200"
    },
    {
        id: 2,
        title: "بطاقة أعمال",
        price: 149,
        image: "https://via.placeholder.com/300x200"
    },
    {
        id: 3,
        title: "تصميم سوشيال ميديا",
        price: 199,
        image: "https://via.placeholder.com/300x200"
    }
];

// عرض التصاميم
function displayDesigns() {
    const container = document.getElementById('designsContainer');
    container.innerHTML = designs.map(design => `
        <div class="col-md-4 mb-4">
            <div class="design-card">
                <img src="${design.image}" class="card-img-top" alt="${design.title}">
                <div class="card-body">
                    <h5 class="card-title">${design.title}</h5>
                    <p class="card-text">${design.price} ريال</p>
                    <button class="btn btn-primary" onclick="addToCart(${design.id})">
                        أضف للسلة
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

// إضافة للسلة
function addToCart(designId) {
    const user = JSON.parse(localStorage.getItem('user'));

if (!user) {
        alert('الرجاء تسجيل الدخول أولاً');
        window.location.href = 'login.html';
        return;
    }

    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const design = designs.find(d => d.id === designId);

    if (design) {
        const existingItem = cart.find(item => item.id === designId);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            cart.push({ ...design, quantity: 1 });
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartBadge();
        alert('تمت الإضافة للسلة');
    }
}

// تحديث شارة السلة
function updateCartBadge() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const badge = document.getElementById('cartBadge');
    const total = cart.reduce((sum, item) => sum + item.quantity, 0);
    badge.textContent = total;
}

// عرض السلة
function showCart() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');

    cartItems.innerHTML = cart.map(item => `
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <h6>${item.title}</h6>
                <small>${item.price} × ${item.quantity}</small>
            </div>
            <div>
                <button class="btn btn-sm btn-outline-danger" 
                    onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                <span class="mx-2">${item.quantity}</span>
                <button class="btn btn-sm btn-outline-success"
                    onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
            </div>
        </div>
    `).join('');

    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    cartTotal.textContent = total;

new bootstrap.Modal(document.getElementById('cartModal')).show();
}

// تحديث الكمية
function updateQuantity(id, newQuantity) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    
    if (newQuantity < 1) {
        cart = cart.filter(item => item.id !== id);
    } else {
        const item = cart.find(item => item.id === id);
        if (item) item.quantity = newQuantity;
    }

    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartBadge();
    showCart();
}

// إتمام الطلب
async function checkout() {
    const user = JSON.parse(localStorage.getItem('user'));
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');

    if (!user || cart.length === 0) {
        alert('الرجاء تسجيل الدخول وإضافة منتجات للسلة');
        return;
    }

    try {
        const { data, error } = await supabase
            .from('orders')
            .insert([{
                user_id: user.id,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
            }]);

        if (error) throw error;

        await emailjs.send("service_l82w2oc", "template_43nya5a", {
            to_name: user.email,
            message: "تم استلام طلبك بنجاح"
        });

        localStorage.removeItem('cart');
        updateCartBadge();
        bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
        alert('تم إرسال طلبك بنجاح!');

    } catch (error) {
        console.error('Error:', error);
        alert('حدث خطأ أثناء إتمام الطلب');
    }
}

// تهيئة الصفحة
document.addEventListener('DOMContentLoaded', () => {
    displayDesigns();
    updateCartBadge();
    
    document.getElementById('cartBtn').addEventListener('click', showCart);
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        await supabase.auth.signOut();
        localStorage.removeItem('user');
        localStorage.removeItem('cart');
        updateCartBadge();

        window.location.href = 'login.html';
    });

    // التحقق من حالة تسجيل الدخول
    const user = JSON.parse(localStorage.getItem('user'));
    if (user) {
        document.getElementById('userName').textContent = user.email;
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
